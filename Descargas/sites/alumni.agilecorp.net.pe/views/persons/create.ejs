<div class="col-12">
  <form id="formCreate" action="/persons/create" enctype="multipart/form-data" method="POST">
    <div class="card border rounded-3">
      <div class="card-header  border-bottom p-3">
        <div class="d-sm-flex justify-content-between align-items-center">
          <h5 class="mb-2 mb-sm-0">Agregar Persona</h5>
        </div>
      </div>
      <div class="card-body">
        <div class="row">
          <% if (error !='' ) { %>
            <div class="text-danger">
              <%= error %>"
            </div>
            <% } else { %>
              <div class="col-md-4 mt-5">
                <img id="previewImage" src="/assets/img/photo_person.png"  class="img-fluid img-thumbnail" />
                <input type="file" name="inputFile" id="inputFile" accept="image/jpeg, image/png, image/jpg" style="display: none;">
              </div>
              <div class="col-md-8">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" role="switch" 
                    name="Status" >
                  <label class="form-check-label" for="flexSwitchCheckDefault">Estado</label>
                </div>
                <div class="form-group">
                  <label for="Id_area" class="control-label">Área</label>
                  <select name="Id_area" id="Id_area" class="form-select" >
                    <% companies.forEach(function(company) { %>
                      <option value="<%= company.Id_area %>">
                        <%= company.Area %>
                      </option>
                      <% }); %>
                  </select>
                  <span for="Id_area" class="text-danger"></span>
                </div>

                <div class="form-group">
                  <label for="ProgramId" class="control-label">Programas</label>
                  <select name="ProgramId" id="ProgramId" class="form-select" multiple>
                    <% program.forEach(function(item) { %>
                      <option value="<%= item.Id %>">
                        <%= item.Name %> - <%= item.Year %>
                      </option>
                    <% }); %>
                  </select>
                  <span for="Id_area" class="text-danger"></span>
                </div>
                

                <div class="form-group">
                  <label for="FirstName" class="control-label">Nombre</label>
                  <input name="firstName" id="firstName" class="form-control" type="text" />
                  <span for="FirstName" class="text-danger"></span>
                </div>
                <div class="form-group">
                  <label for="LastName" class="control-label">Apellido</label>
                  <input name="lastName" id="lastName" class="form-control" type="text" />
                  <span for="LastName" class="text-danger"></span>
                </div>
                <div class="form-group">
                  <label for="Email" class="control-label">Email</label>
                  <input name="email" id="email" class="form-control" type="text" />
                  <span for="Email" class="text-danger"></span>
                </div>
                <div class="form-group">
                  <label for="Password" class="control-label">Password</label>
                  <input name="password" id="password" class="form-control" type="text" />
                  <span for="Password" class="text-danger"></span>
                </div>
                <div class="form-group">
                  <label for="PhoneNumber" class="control-label">Celular</label>
                  <input name="phoneNumber" id="phoneNumber" class="form-control" type="text" />
                  <span for="PhoneNumber" class="text-danger"></span>
                </div>
                <div class="form-group">
                  <label for="Address" class="control-label">Dirección</label>
                  <input name="Address" id="Address" class="form-control" type="text" />
                  <span for="Address" class="text-danger"></span>
                </div>
                <div class="form-group">
                  <label for="Title" class="control-label">Titulo</label>
                  <input name="Title" id="Title" class="form-control" type="text" />
                  <span for="Title" class="text-danger"></span>
                </div>
                <div class="form-group">
                  <label for="JobTitle" class="control-label">Cargo</label>
                  <input name="JobTitle" id="JobTitle" class="form-control" type="text" />
                  <span for="JobTitle" class="text-danger"></span>
                </div>
              </div>
              <div class="col-md-12">
                <table class="table table-borderless">
                  <tr>
                    <td>
                      <div class="form-group form-switch">
                        <input class="form-check-input" type="checkbox" id="WhatsappStatus" name="WhatsappStatus">
                        <label class="form-check-label" >Whatsapp</label>
                        <input name="Whatsapp" id="Whatsapp" class="form-control" type="text" />
                      </div>
                    </td>
                    <td>
                      <div class="form-group form-switch">
                        <input class="form-check-input" type="checkbox" id="InstagramStatus" name="InstagramStatus">
                        <label class="form-check-label" >Instagram</label>
                        <input name="Instagram" id="Instagram" class="form-control" type="text" />
                      </div>
                    </td>
                    <td>
                      <div class="form-group form-switch">
                        <input class="form-check-input" type="checkbox" id="FacebookStatus" name="FacebookStatus">
                        <label class="form-check-label" >Facebook</label>
                        <input name="Facebook" id="Facebook" class="form-control" type="text" />
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div class="form-group form-switch">
                        <input class="form-check-input" type="checkbox" id="YoutubeStatus" name="YoutubeStatus">
                        <label class="form-check-label" >Youtube</label>
                        <input name="Youtube" id="Youtube" class="form-control" type="text" />
                      </div>
                    </td>
                    <td>
                      <div class="form-group form-switch">
                        <input class="form-check-input" type="checkbox" id="TelegramStatus" name="TelegramStatus">
                        <label class="form-check-label" >Telegram</label>
                        <input name="Telegram" id="Telegram" class="form-control" type="text" />
                      </div>
                    </td>
                    <td>
                      <div class="form-group form-switch">
                        <input class="form-check-input" type="checkbox" id="TikTokStatus" name="TikTokStatus">
                        <label class="form-check-label" >Tik Tok</label>
                        <input name="TikTok" id="TikTok" class="form-control" type="text" />
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div class="form-group form-switch">
                        <input class="form-check-input" type="checkbox" id="TwitterStatus" name="TwitterStatus">
                        <label class="form-check-label" >Twitter</label>
                        <input name="Twitter" id="Twitter" class="form-control" type="text" />
                      </div>
                    </td>
                    <td>
                      <div class="form-group form-switch">
                        <input class="form-check-input" type="checkbox" id="SnapchatStatus" name="SnapchatStatus">
                        <label class="form-check-label">Snapchat</label>
                        <input name="Snapchat" id="Snapchat" class="form-control" type="text" />
                      </div>
                    </td>
                    <td>
                      <div class="form-group form-switch">
                        <input class="form-check-input" type="checkbox" id="SpotifyStatus" name="SpotifyStatus">
                        <label class="form-check-label" >Spotify</label>
                        <input name="Spotify" id="Spotify" class="form-control" type="text" />
                      </div>
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <div class="form-group form-switch">
                        <input class="form-check-input" type="checkbox" id="WebsiteStatus" name="WebsiteStatus">
                        <label class="form-check-label" >Sitio Web</label>
                        <input name="SitioWeb" id="SitioWeb" class="form-control" type="text" />
                      </div>
                    </td>
                    <td>
                      <div class="form-group form-switch">
                        <input class="form-check-input" type="checkbox" id="LinkedinStatus" name="LinkedinStatus">
                        <label class="form-check-label" >Linkedin</label>
                        <input name="Linkedin" id="Linkedin" class="form-control" type="text" />
                      </div>
                    </td>
                    <td>
                      <div class="form-group form-switch">
                        <input class="form-check-input" type="checkbox" id="PaypalStatus" name="PaypalStatus">
                        <label class="form-check-label" >PayPal</label>
                        <input name="Paypal" id="Paypal" class="form-control" type="text" />
                      </div>
                    </td>
                  </tr>
                </table>


              </div>
              <div class="col-md-4">
                <div class="form-group">



                </div>
                <% } %>
              </div>
        </div>
        <div class="card-footer  border-bottom p-3">
          <div class="d-sm-flex justify-content-between align-items-center">
            <button class="btn btn-sm btn-info" type="button" onclick="window.location.href='/persons'"><i class="fa-solid fa-arrow-left"></i>
              Regresar</button>
            <button class="btn btn-sm btn-primary" type="submit" id="btnSave"><i class="fa-solid fa-floppy-disk"></i>
              Agregar </button>
          </div>
        </div>
      </div>
  </form>
</div>
<!-- Agrega estos enlaces en tu archivo HTML -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>

<script>

  $(document).ready(function() {
    $('#ProgramId').select2();
  });
  
  $(document).ready(function() {
    // Manejar cambios en los checkboxes y aplicar validación condicional
    $('.form-check-input').change(function() {
      var inputId = $(this).attr('id').replace('Status', ''); // Obtener el ID del input relacionado
      var inputField = $('#' + inputId);

      // Aplicar validación solo si el checkbox está marcado
      if ($(this).prop('checked')) {
        inputField.prop('required', true);
      } else {
        inputField.prop('required', false);
      }
    });

    // Manejar el envío del formulario
    $('#formCreate').submit(function() {
      // Aquí puedes agregar cualquier lógica de validación adicional si es necesario

      // Continuar con el envío del formulario
      return true;
    });
  });
</script>


<!-- <script>
  $(document).ready(function() {
    // Agregar un evento para todos los checkboxes con clase form-check-input
    $('.form-check-input').change(function() {
      // Inicializa un objeto para almacenar los valores
      var valores = {};
  
      // Itera a través de todos los checkboxes
      $('.form-check-input').each(function() {
        var id = $(this).attr('id');
        var valor = this.checked ? 1 : 0;
        valores[id] = valor;
      });
  
      // Envía el objeto de valores a tu servidor o haz lo que necesites con él
      console.log(valores); // Esto imprimirá los valores en la consola
      // Aquí puedes enviar los valores a tu servidor usando una solicitud AJAX, por ejemplo.
    });
  });
  $('.form-check-input').each(function() {
    var checkboxId = $(this).attr('id');
    var inputElement = $('#' + checkboxId.replace('check', ''));
    inputElement.prop('disabled', true);
  });
  $('.form-check-input').change(function() {
    // Obtén el ID del checkbox que cambió
    var checkboxId = $(this).attr('id');
    // Encuentra el input correspondiente usando el ID del checkbox
    var inputElement = $('#' + checkboxId.replace('check', ''));
    
    // Activa o desactiva el input según el estado del checkbox
    if (this.checked) {
      inputElement.prop('disabled', false);
    } else {
      inputElement.prop('disabled', true);
    }
  });
  </script> -->
<script>
  const inputFile = document.getElementById('inputFile');
  const previewImage = document.getElementById('previewImage');

  previewImage.addEventListener('click', () => {
    inputFile.click();
  });


  inputFile.addEventListener('change', () => {
    if (inputFile.files && inputFile.files[0]) {
      const reader = new FileReader();
      reader.onload = function (e) {
        previewImage.src = e.target.result;
      };
      reader.readAsDataURL(inputFile.files[0]);
    }
  });

  const form = document.getElementById('formCreate');
  form.addEventListener('submit', function (event) {

    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    console.log('datos enviados'+ data);

    const errors = validate(data, constraints);
    console.log(errors);
    if (errors) {

      for (const field in errors) {
        const errorMessage = errors[field][0];
        const fieldElement = document.getElementById(field);
        fieldElement.classList.add('error');
        fieldElement.nextElementSibling.textContent = errorMessage;
      }
      event.preventDefault();
    } else {
      const btn = document.getElementById('btnSave');
      btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin-pulse"></i> Procesando';
      btn.disabled = true;
    }
  });

</script>
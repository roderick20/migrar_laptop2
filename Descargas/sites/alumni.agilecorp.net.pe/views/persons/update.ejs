<div class="container">
  <div class="row">
    <div class="col-md-8">
      <form id="formCreate" action="/persons/update" enctype="multipart/form-data" method="POST">
        <div class="card border rounded-3">
          <div class="card-header  border-bottom p-3">
            <div class="d-sm-flex justify-content-between align-items-center">
              <h5 class="mb-2 mb-sm-0">Agregar Persona</h5>
            </div>
          </div>
          <div class="card-body">
            <div class="row">

              <% if (error !='' ) { %>
                <div class="text-danger">
                  <%= error %>"
                </div>
                <% } else { %>
                  <div class="col-md-4 mt-5">
                    <input type="file" name="inputFile" id="inputFile" accept="image/jpeg, image/png, image/jpg"  style="display: none;">
                    <img id="previewImage" src="/uploads/<%= person.Photo ? person.Photo : 'photo_person.png' %>"
                    class="img-fluid img-thumbnail" />
                  </div>
                  <div class="col-md-8">
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" role="switch" 
                        name="Status"   <%= person.Status ? 'checked' : '' %>>
                      <label class="form-check-label">Estado</label>
                    </div>
                    <div class="form-group">
                      <input type="hidden" name="Id" id="Id" value="<%= person.Id %>">
                      <input type="hidden" name="Role" id="Role" value="<%= person.Role %>">
                      <input type="hidden" name="UniqueId" id="UniqueId" value="<%= person.UniqueId %>">
                      <label for="CompanyId" class="control-label">Área</label>
                      <select name="Id_area" id="Id_area" class="form-select">
                        <% companies.forEach(function(company) { %>
                          <option value="<%= company.Id_area %>" <%=company.Id_area===person.Id_area ? 'selected' : ''
                            %>
                            ><%= company.Area %>
                          </option>
                          <% }); %>
                      </select>
                      <span for="Id_area" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                      <label for="ProgramId" class="control-label">Programas</label>
                      <select name="ProgramId" id="ProgramId" class="form-select" multiple required>
                          <% program.forEach(function(item) { %>
                              <% const isSelected = programperson.some(obj => obj.ProgramId === item.Id.toString()); %>
                              <option value="<%= item.Id %>" <%= isSelected ? 'selected' : '' %>>
                                  <%= item.Name %> - <%= item.Year %>
                              </option>
                          <% }); %>
                      </select>
                      <span for="Id_area" class="text-danger"></span>
                  </div>
                  
                  

                    <div class="form-group">
                      <label for="FirstName" class="control-label">Nombre</label>
                      <input name="firstName" id="firstName" class="form-control" type="text"
                        value="<%= person.FirstName %>" />
                      <span for="FirstName" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                      <label for="LastName" class="control-label">Apellido</label>
                      <input name="lastName" id="lastName" class="form-control" type="text"
                        value="<%= person.LastName %>" />
                      <span for="LastName" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                      <label for="Email" class="control-label">Email</label>
                      <input name="email" id="email" class="form-control" type="text" value="<%= person.Email %>" />
                      <span for="Email" class="text-danger"></span>
                    </div>
                    <!-- <div class="form-group">
                      <label for="Password" class="control-label">Password</label>
                      <input name="password" id="password" class="form-control" type="password"
                        value="" />
                      <span for="Password" class="text-danger"></span>
                    </div> -->
                    <div class="form-group">
                      <label for="PhoneNumber" class="control-label">Celular</label>
                      <input name="phoneNumber" id="phoneNumber" class="form-control" type="text"
                        value="<%= person.PhoneNumber %>" />
                      <span for="PhoneNumber" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                      <label for="Address" class="control-label">Dirección</label>
                      <input name="Address" id="Address" class="form-control" type="text"
                        value="<%= person.Address %>" />
                      <span for="Address" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                      <label for="Title" class="control-label">Titulo</label>
                      <input name="Title" id="Title" class="form-control" type="text" value="<%= person.Title %>"/>
                      <span for="Title" class="text-danger"></span>
                    </div>
                    <div class="form-group">
                      <label for="JobTitle" class="control-label">Cargo</label>
                      <input name="JobTitle" id="JobTitle" class="form-control" type="text" value="<%= person.JobTitle %>" />
                      <span for="JobTitle" class="text-danger"></span>
                    </div>
                  </div>
                  <div class="col-md-12">
                    <table class="table table-borderless">
                      <tr>
                        <td>
                          <div class="form-group form-switch">
                            <input class="form-check-input" type="checkbox" id="WhatsappStatus" name="WhatsappStatus"   <%= person.WhatsappStatus ? 'checked' : '' %>>
                            <label class="form-check-label" >Whatsapp</label>
                            <input name="Whatsapp" id="Whatsapp" class="form-control" type="text"
                              value="<%= person.Whatsapp %>" />
                          </div>
                        </td>
                        <td>
                          <div class="form-group form-switch">
                            <input class="form-check-input" type="checkbox" id="InstagramStatus" name="InstagramStatus"   <%= person.InstagramStatus ? 'checked' : '' %>>
                            <label class="form-check-label" >Instagram</label>
                            <input name="Instagram" id="Instagram" class="form-control" type="text"
                              value="<%= person.Instagram %>" />
                          </div>
                        </td>
                        <td>
                          <div class="form-group form-switch">
                            <input class="form-check-input" type="checkbox" id="FacebookStatus" name="FacebookStatus"   <%= person.FacebookStatus ? 'checked' : '' %>>
                            <label class="form-check-label" >Facebook</label>
                            <input name="Facebook" id="Facebook" class="form-control" type="text"
                              value="<%= person.Facebook %>" />
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <div class="form-group form-switch">
                            <input class="form-check-input" type="checkbox" id="YoutubeStatus" name="YoutubeStatus"   <%= person.YoutubeStatus ? 'checked' : '' %>>
                            <label class="form-check-label" >Youtube</label>
                            <input name="Youtube" id="Youtube" class="form-control" type="text"
                              value="<%= person.Youtube %>" />
                          </div>
                        </td>
                        <td>
                          <div class="form-group form-switch">
                            <input class="form-check-input" type="checkbox" id="TelegramStatus" name="TelegramStatus"   <%= person.TelegramStatus ? 'checked' : '' %>>
                            <label class="form-check-label" >Telegram</label>
                            <input name="Telegram" id="Telegram" class="form-control" type="text"
                              value="<%= person.Telegram %>" />
                          </div>
                        </td>
                        <td>
                          <div class="form-group form-switch">
                            <input class="form-check-input" type="checkbox" id="TikTokStatus" name="TikTokStatus"   <%= person.TikTokStatus ? 'checked' : '' %>>
                            <label class="form-check-label" >Tik Tok</label>
                            <input name="TikTok" id="TikTok" class="form-control" type="text"
                              value="<%= person.TikTok %>" />
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <div class="form-group form-switch">
                            <input class="form-check-input" type="checkbox" id="TwitterStatus" name="TwitterStatus"   <%= person.TwitterStatus ? 'checked' : '' %>>
                            <label class="form-check-label" >Twitter</label>
                            <input name="Twitter" id="Twitter" class="form-control" type="text"
                              value="<%= person.Twitter %>" />
                          </div>
                        </td>
                        <td>
                          <div class="form-group form-switch">
                            <input class="form-check-input" type="checkbox" id="SnapchatStatus" name="SnapchatStatus"   <%= person.SnapchatStatus ? 'checked' : '' %>>
                            <label class="form-check-label" >Snapchat</label>
                            <input name="Snapchat" id="Snapchat" class="form-control" type="text"
                              value="<%= person.Snapchat %>" />
                          </div>
                        </td>
                        <td>
                          <div class="form-group form-switch">
                            <input class="form-check-input" type="checkbox" id="SpotifyStatus" name="SpotifyStatus"   <%= person.SpotifyStatus ? 'checked' : '' %>>
                            <label class="form-check-label" >Spotify</label>
                            <input name="Spotify" id="Spotify" class="form-control" type="text"
                              value="<%= person.Spotify %>" />
                          </div>
                        </td>
                      </tr>
                      <tr>
                        <td>
                          <div class="form-group form-switch">
                            <input class="form-check-input" type="checkbox" id="WebsiteStatus" name="WebsiteStatus"   <%= person.WebsiteStatus ? 'checked' : '' %>>
                            <label class="form-check-label" >Sitio Web</label>
                            <input name="Website" id="Website" class="form-control" type="text"
                              value="<%= person.Website %>" />
                          </div>
                        </td>
                        <td>
                          <div class="form-group form-switch">
                            <input class="form-check-input" type="checkbox" id="LinkedinStatus" name="LinkedinStatus"   <%= person.LinkedinStatus ? 'checked' : '' %>>
                            <label class="form-check-label" >Linkedin</label>
                            <input name="Linkedin" id="Linkedin" class="form-control" type="text"
                              value="<%= person.Linkedin %>" />
                          </div>
                        </td>
                        <td>
                          <div class="form-group form-switch">
                            <input class="form-check-input" type="checkbox" id="PaypalStatus" name="PaypalStatus"   <%= person.PaypalStatus ? 'checked' : '' %>>
                            <label class="form-check-label" >PayPal</label>
                            <input name="Paypal" id="Paypal" class="form-control" type="text"
                              value="<%= person.Paypal %>" />
                          </div>
                        </td>
                      </tr>
                    </table>


                  </div>
                  <div class="col-md-4">
                    <div class="form-group">



                    </div>
                    <% } %>
                  </div>
            </div>
            <div class="card-footer  border-bottom p-3">
              <div class="d-sm-flex justify-content-between align-items-center">
                <button class="btn btn-sm btn-info" type="button" onclick="window.location.href='/persons'"><i class="fa-solid fa-arrow-left"></i>
                  Regresar</button>
                <button class="btn btn-sm btn-primary" type="submit" id="btnSave"><i
                    class="fa-solid fa-floppy-disk"></i>
                  Actualizar </button>
              </div>
            </div>
          </div>
      </form>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card border rounded-3">
      <div class="card-header border-bottom p-3 d-flex justify-content-between">
        <h5 class="mb-2 mb-sm-0">Tarjeta de Presentación</h5>
        <a href="/settings/create/<%= person.Id %>/<%= person.UniqueId %>"><i class="fa-solid fa-gear"></i></a>
      </div>
      <div class="card-body text-center">
        <!-- Input para cargar la imagen redonda centrada -->
        <div class="mb-3">
          <div class="background-image"></div>
          <input type="file" name="inputFile" id="inputFile" style="display: none;">
          <img id="previewImage" src="/uploads/<%= person.Photo ? person.Photo : 'photo_person.png' %>"
          class="img-fluid img-thumbnail rounded-circle mt-5" style="height: 150px; width: 150px; object-fit: cover;  position: relative;
          object-position: center center; z-index: 1;  border: 5px solid black;">
        </div>
        <!-- Nombre de la persona centrado -->
        <h5><%= person.FirstName %><%= person.LastName %></h5>
        <!-- Profesión de la persona centrada -->
        <p><%= person.Title %></p>
        <!-- Biografía de la persona centrada -->
        <p><%= person.JobTitle %></p>
        <!-- Botón para guardar contacto -->
        
        <!-- Iconos de redes sociales como botones -->
        <div class="social-icons-container">
          <div class="social-icons">
              <% if (person.WhatsappStatus) { %>
                  <a href="<%= person.Whatsapp %>" class="btn btn-social social-icon" style="background-color: #000; color: #fff;;" target="_blank"><i class="fab fa-whatsapp fa-xl"></i></a>
              <% } %>
      
              <% if (person.InstagramStatus) { %>
                  <a href="<%= person.Instagram %>" class="btn btn-social  social-icon" style="background-color: #000; color: #fff;" target="_blank"><i class="fab fa-instagram fa-xl"></i></a>
              <% } %>
      
              <% if (person.FacebookStatus) { %>
                  <a href="<%= person.Facebook %>" class="btn btn-social  social-icon" style="background-color: #000; color: #fff;" target="_blank"><i class="fab fa-facebook fa-xl"></i></a>
              <% } %>
      
              <% if (person.YoutubeStatus) { %>
                  <a href="<%= person.Youtube %>" class="btn btn-social  social-icon" style="background-color: #000; color: #fff;" target="_blank"><i class="fab fa-youtube fa-xl"></i></a>
              <% } %>
      
              <% if (person.TelegramStatus) { %>
                  <a href="<%= person.Telegram %>" class="btn btn-social social-icon" style="background-color: #000; color: #fff;" target="_blank"><i class="fab fa-telegram fa-xl"></i></a>
              <% } %>
      
              <% if (person.TikTokStatus) { %>
                  <a href="<%= person.TikTok %>" class="btn btn-social social-icon" style="background-color: #000; color: #fff;" target="_blank"><i class="fab fa-tiktok fa-xl"></i></a>
              <% } %>
      
              <% if (person.TwitterStatus) { %>
                  <a href="<%= person.Twitter %>" class="btn btn-social btn-twitter social-icon" style="background-color: #000; color: #fff;" target="_blank"><i class="fab fa-twitter fa-xl"></i></a>
              <% } %>
      
              <% if (person.SnapchatStatus) { %>
                  <a href="<%= person.Snapchat %>" class="btn btn-social social-icon" style="background-color: #000; color: #fff;" target="_blank">
                      <i class="fab fa-snapchat fa-xl" style="color: #fff; font-weight: bold;"></i>
                  </a>
              <% } %>
      
              <% if (person.SpotifyStatus) { %>
                  <a href="<%= person.Spotify %>" class="btn btn-social social-icon" style="background-color: #000; color: #fff;" target="_blank"><i class="fab fa-spotify fa-xl"></i></a>
              <% } %>
      
              <% if (person.WebsiteStatus) { %>
                  <a href="<%= person.Website %>" class="btn btn-social social-icon" style="background-color: #000; color: #fff;" target="_blank"><i class="fa-solid fa-arrow-up-right-from-square"></i></a>
              <% } %>
      
              <% if (person.LinkedinStatus) { %>
                  <a href="<%= person.Linkedin %>" class="btn bbtn-social social-icon" style="background-color: #000; color: #fff;" target="_blank"><i class="fab fa-linkedin fa-xl"></i></a>
              <% } %>
      
              <% if (person.PaypalStatus) { %>
                  <a href="<%= person.Paypal %>" class="btn btn-social social-icon" style="background-color: #000; color: #fff;" target="_blank"><i class="fa-brands fa-cc-paypal fa-2xl"></i></a>
              <% } %>
          </div>
      </div>
      
        <div class="card text-center mt-3">
          <div class="card-body">
            <div class="mb-3">
              <button class="btn btn-primary">
                <a href="/personcardqr/<%= person.UniqueId %>" target="_blank" class="text-white"><i class="fa-solid fa-link"></i> Link de Contacto</a>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Agrega estos enlaces en tu archivo HTML -->
<link href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.min.js"></script>
<script>

  $(document).ready(function() {
    $('#ProgramId').select2();
  });

  $(document).ready(function() {
    // Manejar cambios en los checkboxes y aplicar validación condicional
    $('.form-check-input').change(function() {
      var inputId = $(this).attr('id').replace('Status', ''); // Obtener el ID del input relacionado
      var inputField = $('#' + inputId);

      // Aplicar validación solo si el checkbox está marcado
      if ($(this).prop('checked')) {
        inputField.prop('required', true);
      } else {
        inputField.prop('required', false);
      }
    });

    // Manejar el envío del formulario
    $('#formCreate').submit(function(event) {
      // Iterar a través de los checkboxes y validar los campos correspondientes
      $('.form-check-input').each(function() {
        var inputId = $(this).attr('id').replace('Status', ''); // Obtener el ID del input relacionado
        var inputField = $('#' + inputId);

        // Verificar si el checkbox está marcado y el campo de texto está vacío o null
        if ($(this).prop('checked') && (!inputField.val() || inputField.val().trim() === '')) {
          alert('Por favor, complete los campos obligatorios.');
          event.preventDefault();
          return false; // Salir del bucle each
        }
      });
    });
  });
</script>

<style>
  .social-icons-container {
    display: flex;
    justify-content: center;
  }

  .social-icon {
    margin-right: 10px; /* Ajusta el margen entre iconos según sea necesario */
    margin-bottom: 10px; /* Ajusta el margen inferior entre filas según sea necesario */
  }

  .card {
    position: relative;
    overflow: hidden;
  }

  .card-body {
    position: relative;
    z-index: 1;
  }

  .background-image {
    position: absolute; 
    top: 15%;
    left: 50%;
    width: 100%; /* Ajusta el tamaño según sea necesario */
    height: 150px; /* Ajusta el tamaño según sea necesario */
    transform: translate(-50%, -50%);
    background-image: url("/uploads/<%= settings.Image ? settings.Image : 'fondo.jpg' %>"); /* Cambia la ruta de la imagen según tu necesidad */
    background-size: cover;
    object-position: center center;
    z-index: 0;
  }

</style>
<!-- <script>
  $(document).ready(function () {
    // Agregar un evento para todos los checkboxes con clase form-check-input
    $('.form-check-input').change(function () {
      // Inicializa un objeto para almacenar los valores
      var valores = {};

      // Itera a través de todos los checkboxes
      $('.form-check-input').each(function () {
        var id = $(this).attr('id');
        var valor = this.checked ? 1 : 0;
        valores[id] = valor;
      });

      // Envía el objeto de valores a tu servidor o haz lo que necesites con él
      console.log(valores); // Esto imprimirá los valores en la consola
      // Aquí puedes enviar los valores a tu servidor usando una solicitud AJAX, por ejemplo.
    });
  });
  $('.form-check-input').each(function () {
    var checkboxId = $(this).attr('id');
    var inputElement = $('#' + checkboxId.replace('check', ''));
    inputElement.prop('disabled', true);
  });
  $('.form-check-input').change(function () {
    // Obtén el ID del checkbox que cambió
    var checkboxId = $(this).attr('id');
    // Encuentra el input correspondiente usando el ID del checkbox
    var inputElement = $('#' + checkboxId.replace('check', ''));

    // Activa o desactiva el input según el estado del checkbox
    if (this.checked) {
      inputElement.prop('disabled', false);
    } else {
      inputElement.prop('disabled', true);
    }
  });
</script> -->
<script>
  const inputFile = document.getElementById('inputFile');
  const previewImage = document.getElementById('previewImage');

  previewImage.addEventListener('click', () => {
    inputFile.click();
  });


  inputFile.addEventListener('change', () => {
    if (inputFile.files && inputFile.files[0]) {
      const reader = new FileReader();
      reader.onload = function (e) {
        previewImage.src = e.target.result;
      };
      reader.readAsDataURL(inputFile.files[0]);
    }
  });

  const form = document.getElementById('formCreate');
  form.addEventListener('submit', function (event) {

    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());
    console.log('datos enviados' + data);

    const errors = validate(data, constraints);
    console.log(errors);
    if (errors) {

      for (const field in errors) {
        const errorMessage = errors[field][0];
        const fieldElement = document.getElementById(field);
        fieldElement.classList.add('error');
        fieldElement.nextElementSibling.textContent = errorMessage;
      }
      event.preventDefault();
    } else {
      const btn = document.getElementById('btnSave');
      btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin-pulse"></i> Procesando';
      btn.disabled = true;
    }
  });
  $(document).ready(function () {
    // Agregar un evento para todos los checkboxes con clase form-check-input
    $('.form-check-input').change(function () {
      // Itera a través de todos los checkboxes y muestra u oculta los elementos correspondientes
      $('.social-icon').each(function () {
        var checkboxId = $(this).attr('id');
        var inputElement = $('#' + checkboxId.replace('check', ''));
  
        // Muestra u oculta el icono según el estado del checkbox
        if (inputElement.prop('checked')) {
          $(this).show();
        } else {
          $(this).hide();
        }
      });
    });
  });
  
</script>